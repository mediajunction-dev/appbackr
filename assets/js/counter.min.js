/*
* jQuery Simply Countable plugin
* Provides a character counter for any text input or textarea
* 
* @version  0.4.2
* @homepage http://github.com/aaronrussell/jquery-simply-countable/
* @author   Aaron Russell (http://www.aaronrussell.co.uk)
*
* Copyright (c) 2009-2010 Aaron Russell (aaron@gc4.co.uk)
* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
* and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
*/(function(e){e.fn.simplyCountable=function(t){t=e.extend({counter:"#counter",countType:"characters",maxCount:140,strictMax:!1,countDirection:"down",safeClass:"safe",overClass:"over",thousandSeparator:",",onOverCount:function(){},onSafeCount:function(){},onMaxCount:function(){}},t);var n=[33,34,35,36,37,38,39,40];return e(this).each(function(){var r=e(this),i=e(t.counter);if(!i.length)return!1;var s=function(){var n,s,o=function(e){return e-e*2+t.maxCount},u=function(){return t.countDirection==="up"?s:n},a=function(e){var n="";if(t.thousandSeparator){e=e.toString();if(e.match(/^-/)){e=e.substr(1);n="-"}for(var r=e.length-3;r>0;r-=3)e=e.substr(0,r)+t.thousandSeparator+e.substr(r)}return n+e},f=function(e){r.val(e).trigger("change")};if(t.countType==="words"){n=t.maxCount-e.trim(r.val()).split(/\s+/).length;r.val()===""&&(n+=1)}else n=t.maxCount-r.val().length;s=o(n);if(t.strictMax&&n<=0){var l=r.val();n<0&&t.onMaxCount(u(),r,i);if(t.countType==="words"){var c=l.match(new RegExp("\\s?(\\S+\\s+){"+t.maxCount+"}"));c&&f(c[0])}else f(l.substring(0,t.maxCount));n=0,s=t.maxCount}i.text(a(u()));if(!i.hasClass(t.safeClass)&&!i.hasClass(t.overClass))n<0?i.addClass(t.overClass):i.addClass(t.safeClass);else if(n<0&&i.hasClass(t.safeClass)){i.removeClass(t.safeClass).addClass(t.overClass);t.onOverCount(u(),r,i)}else if(n>=0&&i.hasClass(t.overClass)){i.removeClass(t.overClass).addClass(t.safeClass);t.onSafeCount(u(),r,i)}};s();r.on("keyup blur paste",function(t){switch(t.type){case"keyup":e.inArray(t.which,n)<0&&s();break;case"paste":setTimeout(s,t.type==="paste"?5:0);break;default:s()}})})}})(jQuery);